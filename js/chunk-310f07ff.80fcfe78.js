(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-310f07ff"],{"008c":function(e,t,r){"use strict";r.d(t,"a",(function(){return w})),r.d(t,"b",(function(){return x})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return P})),r.d(t,"e",(function(){return I})),r.d(t,"f",(function(){return z})),r.d(t,"g",(function(){return N}));var i=r("b2b2"),n=r("a9ab");const o=(e,t,r)=>[t,r],a=(e,t,r)=>[t,r,e[2]],c=(e,t,r)=>[t,r,e[2],e[3]];function s(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:Object(i["k"])(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function f({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function m(e,t,r){const i=[];let n,o,a,c;for(let s=0;s<r.length;s++){const m=r[s];s>0?(a=l(e,m[0]),c=f(e,m[1]),a===n&&c===o||(i.push(t(m,a-n,c-o)),n=a,o=c)):(n=l(e,m[0]),o=f(e,m[1]),i.push(t(m,n,o)))}return i.length>0?i:null}function u(e,t,r,i){return m(e,r?i?c:a:i?a:o,t)}function h(e,t,r,i){const n=[],s=r?i?c:a:i?a:o;for(let o=0;o<t.length;o++){const r=m(e,s,t[o]);r&&r.length>=3&&n.push(r)}return n.length?n:null}function y(e,t,r,i){const n=[],s=r?i?c:a:i?a:o;for(let o=0;o<t.length;o++){const r=m(e,s,t[o]);r&&r.length>=2&&n.push(r)}return n.length?n:null}function b({scale:e,translate:t},r){return r*e[0]+t[0]}function p({scale:e,translate:t},r){return t[1]-r*e[1]}function g(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[n,o]=e.scale;let a=b(e,r[0][0]),c=p(e,r[0][1]);i[0]=t(r[0],a,c);for(let s=1;s<r.length;s++){const e=r[s];a+=e[0]*n,c-=e[1]*o,i[s]=t(e,a,c)}return i}function d(e,t,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=g(e,t,r[n]);return i}function O(e,t,r,i){return g(e,r?i?c:a:i?a:o,t)}function S(e,t,r,i){return d(e,r?i?c:a:i?a:o,t)}function C(e,t,r,i){return d(e,r?i?c:a:i?a:o,t)}function M(e,t,r,i,n){return t.xmin=l(e,r.xmin),t.ymin=f(e,r.ymin),t.xmax=l(e,r.xmax),t.ymax=f(e,r.ymax),t!==r&&(i&&(t.zmin=r.zmin,t.zmax=r.zmax),n&&(t.mmin=r.mmin,t.mmax=r.mmax)),t}function v(e,t,r,i,n){return t.points=u(e,r.points,i,n),t}function x(e,t,r,i,n){return t.x=l(e,r.x),t.y=f(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t}function j(e,t,r,i,n){const o=h(e,r.rings,i,n);return o?(t.rings=o,t):null}function k(e,t,r,i,n){const o=y(e,r.paths,i,n);return o?(t.paths=o,t):null}function w(e,t){return e&&t?Object(n["f"])(t)?x(e,{},t,!1,!1):Object(n["h"])(t)?k(e,{},t,!1,!1):Object(n["g"])(t)?j(e,{},t,!1,!1):Object(n["e"])(t)?v(e,{},t,!1,!1):Object(n["d"])(t)?M(e,{},t,!1,!1):null:null}function P(e,t,r,n,o){return Object(i["k"])(r)&&(t.points=O(e,r.points,n,o)),t}function I(e,t,r,n,o){return Object(i["j"])(r)||(t.x=b(e,r.x),t.y=p(e,r.y),t!==r&&(n&&(t.z=r.z),o&&(t.m=r.m))),t}function z(e,t,r,n,o){return Object(i["k"])(r)&&(t.rings=C(e,r.rings,n,o)),t}function N(e,t,r,n,o){return Object(i["k"])(r)&&(t.paths=S(e,r.paths,n,o)),t}},"405c":function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return m}));var i=r("661c"),n=r("a9ab"),o=r("0eee");function a(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":{const t=e.symbolLayers;return t&&1===t.length?a(t[0]):null}case"CIMVectorMarker":{var t;const r=e.markerGraphics;if(!r||1!==r.length)return null;const i=r[0];if(!i)return null;const n=i.geometry;if(!n)return null;const o=i.symbol;return!o||"CIMPolygonSymbol"!==o.type&&"CIMLineSymbol"!==o.type||null!=(t=o.symbolLayers)&&t.some(e=>!!e.effects)?null:{geom:n,asFill:"CIMPolygonSymbol"===o.type}}case"sdf":return{geom:e.geom,asFill:e.asFill}}return null}function c(e){return e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}function s(e){let t=1/0,r=-1/0,i=1/0,n=-1/0;for(const o of e)for(const e of o)e[0]<t&&(t=e[0]),e[0]>r&&(r=e[0]),e[1]<i&&(i=e[1]),e[1]>n&&(n=e[1]);return new o["a"](t,i,r-t,n-i)}function l(e){let t=1/0,r=-1/0,i=1/0,n=-1/0;for(const o of e)for(const e of o)e[0]<t&&(t=e[0]),e[0]>r&&(r=e[0]),e[1]<i&&(i=e[1]),e[1]>n&&(n=e[1]);return[t,i,r,n]}function f(e){return e?e.rings?l(e.rings):e.paths?l(e.paths):Object(n["d"])(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function m(e,t,r,i,n){const[o,a,c,s]=e;if(c<o||s<a)return[0,0,0];const l=c-o,f=s-a,m=128,u=1,h=Math.floor(.5*(.5*m-u)),y=(m-2*(h+u))/Math.max(l,f),b=Math.round(l*y)+2*h,p=Math.round(f*y)+2*h;let g=1;t&&(g=p/y/(t.ymax-t.ymin));let d=0,O=0;if(i)if(n){if(t&&r&&t.ymax-t.ymin>0){const e=(t.xmax-t.xmin)/(t.ymax-t.ymin);d=i.x/(r*e),O=i.y/r}}else d=i.x,O=i.y;return d=.5*(t.xmax+t.xmin)+d*(t.xmax-t.xmin),O=.5*(t.ymax+t.ymin)+O*(t.ymax-t.ymin),d-=o,O-=a,d*=y,O*=y,d+=h,O+=h,[g,d/b-.5,-(O/p-.5)]}function u(e){const t=c(e.geom),r=s(t),i=128,n=1,o=Math.floor(.5*(.5*i-n)),a=(i-2*(o+n))/Math.max(r.width,r.height),l=Math.round(r.width*a)+2*o,f=Math.round(r.height*a)+2*o,m=[];for(const c of t)if(c&&c.length>1){const t=[];for(const i of c){let[n,c]=i;n-=r.x,c-=r.y,n*=a,c*=a,n+=o-.5,c+=o-.5,e.asFill?t.push([n,c]):t.push([Math.round(n),Math.round(c)])}if(e.asFill){const e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}m.push(t)}const u=h(m,l,f,o);return e.asFill&&y(m,l,f,o,u),[b(u,o),l,f]}function h(e,t,r,i){const n=t*r,o=new Array(n),a=i*i+1;for(let c=0;c<n;++c)o[c]=a;for(const c of e){const e=c.length;for(let n=1;n<e;++n){const e=c[n-1],a=c[n];let s,l,f,m;e[0]<a[0]?(s=e[0],l=a[0]):(s=a[0],l=e[0]),e[1]<a[1]?(f=e[1],m=a[1]):(f=a[1],m=e[1]);let u=Math.floor(s)-i,h=Math.floor(l)+i,y=Math.floor(f)-i,b=Math.floor(m)+i;u<0&&(u=0),h>t&&(h=t),y<0&&(y=0),b>r&&(b=r);const p=a[0]-e[0],g=a[1]-e[1],d=p*p+g*g;for(let i=u;i<h;i++)for(let n=y;n<b;n++){let c,s,l=(i-e[0])*p+(n-e[1])*g;l<0?(c=e[0],s=e[1]):l>d?(c=a[0],s=a[1]):(l/=d,c=e[0]+l*p,s=e[1]+l*g);const f=(i-c)*(i-c)+(n-s)*(n-s),m=(r-n-1)*t+i;f<o[m]&&(o[m]=f)}}}for(let c=0;c<n;++c)o[c]=Math.sqrt(o[c]);return o}function y(e,t,r,i,n){for(const o of e){const e=o.length;for(let a=1;a<e;++a){const e=o[a-1],c=o[a];let s,l,f,m;e[0]<c[0]?(s=e[0],l=c[0]):(s=c[0],l=e[0]),e[1]<c[1]?(f=e[1],m=c[1]):(f=c[1],m=e[1]);let u=Math.floor(s),h=Math.floor(l)+1,y=Math.floor(f),b=Math.floor(m)+1;u<i&&(u=i),h>t-i&&(h=t-i),y<i&&(y=i),b>r-i&&(b=r-i);for(let o=y;o<b;++o){if(e[1]>o==c[1]>o)continue;const a=(r-o-1)*t;for(let t=u;t<h;++t)t<(c[0]-e[0])*(o-e[1])/(c[1]-e[1])+e[0]&&(n[a+t]=-n[a+t]);for(let e=i;e<u;++e)n[a+e]=-n[a+e]}}}}function b(e,t){const r=2*t,n=e.length,o=new Uint8Array(4*n);for(let a=0;a<n;++a){const t=.5-e[a]/r;Object(i["a"])(t,o,4*a)}return o}},"4fcb":function(e,t,r){"use strict";r.d(t,"a",(function(){return U})),r.d(t,"b",(function(){return v}));var i=r("9ef0"),n=r("e92d"),o=r("b2b2"),a=r("a915"),c=r("b3b6"),s=r("82fa"),l=r("793f3"),f=r("405c"),m=r("36b8"),u=r("5dbb"),h=r("89cb");const y=n["a"].getLogger("esri.symbols.cim.cimAnalyzer");function b(e){switch(e){case"Butt":return 0;case"Square":return 2;default:return 1}}function p(e){switch(e){case"Bevel":return 0;case"Miter":return 2;default:return 1}}function g(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function d(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function O(e){let t="",r="";if(e){const i=e.toLowerCase();-1!==i.indexOf("italic")?t="italic":-1!==i.indexOf("oblique")&&(t="oblique"),-1!==i.indexOf("bold")?r="bold":-1!==i.indexOf("light")&&(r="lighter")}return{style:t,weight:r}}function S(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function C(e,t,r,i){let n;e[t]?n=e[t]:(n={},e[t]=n),n[r]=i}function M(e){const t=e.markerPlacement;return t&&t.angleToLine?1:0}async function v(e,t,r,i,n){const o=null!=i?i:[];if(!e)return o;let a,c;const l={};if("CIMSymbolReference"!==e.type)return y.error("Expect cim type to be 'CIMSymbolReference'"),o;if(a=e.symbol,c=e.primitiveOverrides,c){const e=[];for(const r of c){const i=r.valueExpressionInfo;if(i&&t){const n=i.expression,o=Object(s["d"])(n,t.spatialReference,t.fields).then(e=>{e&&C(l,r.primitiveName,r.propertyName,e)});e.push(o)}else null!=r.value&&C(l,r.primitiveName,r.propertyName,r.value)}e.length>0&&await Promise.all(e)}const f=[];switch(W(a,r,f),f.length>0&&await Promise.all(f),a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":x(a,c,l,t,o,r,n)}return o}function x(e,t,r,i,n,o,a){if(!e)return;const c=e.symbolLayers;if(!c)return;const s=e.effects;let f;const m=l["b"].getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(f=1);let u=c.length;for(;u--;){const h=c[u];if(!h||!1===h.enable)continue;let b;s&&s.length&&(b=[...s]);const p=h.effects;p&&p.length&&(s?b.push(...p):b=[...p]);const g=[];switch(l["c"].findApplicableOverrides(h,t,g),h.type){case"CIMSolidFill":j(h,b,r,g,i,n);break;case"CIMPictureFill":k(h,b,r,g,i,o,n);break;case"CIMHatchFill":w(h,b,r,g,i,n);break;case"CIMGradientFill":P(h,b,r,g,i,n);break;case"CIMSolidStroke":I(h,b,r,g,i,n,"CIMPolygonSymbol"===e.type,m);break;case"CIMPictureStroke":z(h,b,r,g,i,n,"CIMPolygonSymbol"===e.type,m);break;case"CIMGradientStroke":N(h,b,r,g,i,n,"CIMPolygonSymbol"===e.type,m);break;case"CIMCharacterMarker":if(L(h,b,r,g,i,n))break;break;case"CIMPictureMarker":if(L(h,b,r,g,i,n))break;"CIMLineSymbol"===e.type&&(f=M(h)),X(h,b,r,g,i,o,n,f,m);break;case"CIMVectorMarker":if(L(h,b,r,g,i,n))break;"CIMLineSymbol"===e.type&&(f=M(h)),R(h,b,r,g,i,n,o,f,m,a);break;default:y.error("Cannot analyze CIM layer",h.type)}}}function j(e,t,r,i,n,o){const a=e.primitiveName,s=Object(m["e"])(e.color),[l,f]=$(i,a),u=Object(c["b"])(JSON.stringify(e)+f).toString();o.push({type:"fill",templateHash:u,materialHash:l?()=>u:u,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:T(a,r,"Color",n,s,D),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t})}function k(e,t,r,i,n,a,s){const l=e.primitiveName,f=e.tintColor?Object(m["e"])(e.tintColor):{r:255,g:255,b:255,a:1},[u,h]=$(i,l),y=Object(c["b"])(JSON.stringify(e)+h).toString(),b=Object(c["b"])(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();let p=Object(m["f"])(e.scaleX);if("width"in e){const t=e.width;let r=1;const i=a.getResource(e.url);Object(o["k"])(i)&&(r=i.width/i.height),p/=r*(e.height/t)}s.push({type:"fill",templateHash:y,materialHash:u?()=>b:b,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:T(l,r,"TintColor",n,f,D),height:T(l,r,"Height",n,e.height),scaleX:T(l,r,"ScaleX",n,p),angle:T(l,r,"Rotation",n,Object(m["f"])(e.rotation)),offsetX:T(l,r,"OffsetX",n,Object(m["f"])(e.offsetX)),offsetY:T(l,r,"OffsetY",n,Object(m["f"])(e.offsetY)),url:e.url})}function w(e,t,r,i,n,o){const a=["Rotation","OffsetX","OffsetY"],s=i.filter(t=>t.primitiveName!==e.primitiveName&&-1===a.indexOf(t.propertyName)),l=e.primitiveName,[f,u]=$(i,l),h=Object(c["b"])(JSON.stringify(e)+u).toString(),y=Object(c["b"])(`${e.separation}${JSON.stringify(e.lineSymbol)}`).toString();o.push({type:"fill",templateHash:h,materialHash:f?G(y,r,s,n):y,cim:e,materialOverrides:s,colorLocked:e.colorLocked,effects:t,color:{r:255,g:255,b:255,a:1},height:T(l,r,"Separation",n,e.separation),scaleX:1,angle:T(l,r,"Rotation",n,Object(m["f"])(e.rotation)),offsetX:T(l,r,"OffsetX",n,Object(m["f"])(e.offsetX)),offsetY:T(l,r,"OffsetY",n,Object(m["f"])(e.offsetY))})}function P(e,t,r,i,n,o){const a=e.primitiveName,[s,l]=$(i,a),f=Object(c["b"])(JSON.stringify(e)+l).toString();o.push({type:"fill",templateHash:f,materialHash:s?G(f,r,i,n):f,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function I(e,t,r,i,n,o,a,s){const l=e.primitiveName,f=Object(m["e"])(e.color),u=void 0!==e.width?e.width:4,h=b(e.capStyle),y=p(e.joinStyle),g=e.miterLimit,[d,O]=$(i,l),S=Object(c["b"])(JSON.stringify(e)+O).toString();let C,M;if(t&&t.length>0){const r=t[t.length-1];if("CIMGeometricEffectDashes"===r.type&&"NoConstraint"===r.lineDashEnding){const r=(t=[...e.effects]).pop();C=r.dashTemplate,M=r.scaleDash}}o.push({type:"line",templateHash:S,materialHash:d?()=>S:S,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:t,color:T(l,r,"Color",n,f,D),width:T(l,r,"Width",n,u),cap:T(l,r,"CapStyle",n,h),join:T(l,r,"JoinStyle",n,y),miterLimit:T(l,r,"MiterLimit",n,g),referenceWidth:s,zOrder:J(e.name),dashTemplate:C,scaleDash:M})}function z(e,t,r,i,n,o,a,s){const l=Object(c["b"])(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),f=e.primitiveName,u=Object(m["e"])(e.tintColor),h=void 0!==e.width?e.width:4,y=b(e.capStyle),g=p(e.joinStyle),d=e.miterLimit,[O,S]=$(i,f),C=Object(c["b"])(JSON.stringify(e)+S).toString();o.push({type:"line",templateHash:C,materialHash:O?()=>l:l,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:t,color:T(f,r,"TintColor",n,u,D),width:T(f,r,"Width",n,h),cap:T(f,r,"CapStyle",n,y),join:T(f,r,"JoinStyle",n,g),miterLimit:T(f,r,"MiterLimit",n,d),referenceWidth:s,zOrder:J(e.name),dashTemplate:null,scaleDash:!1,url:e.url})}function N(e,t,r,i,n,o,a,s){const l=e.primitiveName,f=void 0!==e.width?e.width:4,m=b(e.capStyle),u=p(e.joinStyle),h=e.miterLimit,[y,g]=$(i,l),d=Object(c["b"])(JSON.stringify(e)+g).toString();o.push({type:"line",templateHash:d,materialHash:y?G(d,r,i,n):d,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},width:T(l,r,"Width",n,f),cap:T(l,r,"CapStyle",n,m),join:T(l,r,"JoinStyle",n,u),miterLimit:T(l,r,"MiterLimit",n,h),referenceWidth:s,zOrder:J(e.name),dashTemplate:null,scaleDash:!1})}function L(e,t,r,i,n,o){const a=e.markerPlacement;if(!a||"CIMMarkerPlacementInsidePolygon"!==a.type)return!1;const s=a,l=["Rotation","OffsetX","OffsetY"],f=i.filter(t=>t.primitiveName!==e.primitiveName&&-1===l.indexOf(t.propertyName)),u="url"in e?e.url:null,[h,y]=$(i,s.primitiveName),b=Object(c["b"])(JSON.stringify(e)+y).toString();let p=s.stepY,g=null,d=1;return a.shiftOddRows&&(p*=2,g=function(e){return e?2*e:0},d=.5),o.push({type:"fill",templateHash:b,materialHash:h?G(b,r,f,n):b,cim:e,materialOverrides:f,colorLocked:e.colorLocked,effects:t,color:{r:255,g:255,b:255,a:1},height:T(s.primitiveName,r,"StepY",n,p,g),scaleX:d,angle:T(s.primitiveName,r,"GridAngle",n,s.gridAngle),offsetX:T(s.primitiveName,r,"OffsetX",n,Object(m["f"])(s.offsetX)),offsetY:T(s.primitiveName,r,"OffsetY",n,Object(m["f"])(s.offsetY)),url:u}),!0}function X(e,t,r,i,n,a,s,l,f){var u;const h=e.primitiveName,y=Object(m["f"])(e.size);let b=Object(m["f"])(e.scaleX);const p=Object(m["f"])(e.rotation),g=Object(m["f"])(e.offsetX),d=Object(m["f"])(e.offsetY),O=e.tintColor?Object(m["e"])(e.tintColor):{r:255,g:255,b:255,a:1},S=Object(c["b"])(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),[C,M]=$(i,h),v=Object(c["b"])(JSON.stringify(e)+M).toString(),x=null!=(u=e.anchorPoint)?u:{x:0,y:0};if("width"in e){const t=e.width;let r=1;const i=a.getResource(e.url);Object(o["k"])(i)&&(r=i.width/i.height),b/=r*(y/t)}s.push({type:"marker",templateHash:v,materialHash:C?()=>S:S,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:!1,alignment:l,size:T(h,r,"Size",n,y),scaleX:T(h,r,"ScaleX",n,b),rotation:T(h,r,"Rotation",n,p),offsetX:T(h,r,"OffsetX",n,g),offsetY:T(h,r,"OffsetY",n,d),color:T(h,r,"TintColor",n,O,D),anchorPoint:{x:x.x,y:-x.y},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:f,sizeRatio:1,markerPlacement:e.markerPlacement,url:e.url})}function R(e,t,r,i,n,o,a,c,s,l){const f=e.markerGraphics;if(!f)return;let m=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(m=t.ymax-t.ymin)}for(const u of f)if(u){const f=u.symbol;if(!f)continue;switch(f.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":A(e,t,u,i,r,n,o,a,c,s,m,l);break;case"CIMTextSymbol":_(e,t,u,r,i,n,o,c,s,m)}}}function _(e,t,r,i,n,o,a,s,f,u){const h=[];l["c"].findApplicableOverrides(r,n,h);const y=r.geometry;if(!("x"in y)||!("y"in y))return;const b=r.symbol,p=S(b),C=O(b.fontStyleName),M=Object(m["m"])(b.fontFamilyName);b.font={family:M,decoration:p,...C};const v=e.frame,x=y.x-.5*(v.xmin+v.xmax),j=y.y-.5*(v.ymin+v.ymax),k=e.size/u,w=e.primitiveName,P=Object(m["f"])(b.height)*k,I=Object(m["f"])(b.angle),z=(Object(m["f"])(b.offsetX)+x)*k,N=(Object(m["f"])(b.offsetY)+j)*k,L=Object(m["e"])(l["b"].getFillColor(b));let X=Object(m["e"])(l["b"].getStrokeColor(b)),R=l["b"].getStrokeWidth(b);R||(X=Object(m["e"])(l["b"].getFillColor(b.haloSymbol)),R=b.haloSize*k);const[_,A]=$(n,w),Y=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),F=Object(c["b"])(JSON.stringify(r)+Y+A).toString(),H=T(r.primitiveName,i,"TextString",o,r.textString,m["a"],b.textCase),{fontStyleName:J}=b,D=M+(J?"-"+J.toLowerCase():"-regular"),G=D;a.push({type:"text",templateHash:F,materialHash:_||"function"==typeof H||H.match(/\[(.*?)\]/)?(e,t,r)=>G+"-"+Object(m["d"])(H,e,t,r):G+"-"+Object(c["b"])(H),cim:b,materialOverrides:null,colorLocked:e.colorLocked,effects:t,alignment:s,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:D,decoration:p,weight:T(w,i,"Weight",o,C.weight),style:T(w,i,"Size",o,C.style),size:T(w,i,"Size",o,P),angle:T(w,i,"Rotation",o,I),offsetX:T(w,i,"OffsetX",o,z),offsetY:T(w,i,"OffsetY",o,N),horizontalAlignment:g(b.horizontalAlignment),verticalAlignment:d(b.verticalAlignment),text:H,color:L,outlineColor:X,outlineSize:R,referenceSize:f,sizeRatio:1,markerPlacement:e.markerPlacement})}function A(e,t,r,i,n,o,a,s,h,y,b,p){const g=r.symbol,d=g.symbolLayers;if(!d)return;if(p)return void F(e,t,r,n,i,o,a,s,h,y,b);let O=d.length;if(E(d))return void Y(e,r,d,i,n,o,a,h,y,b);const S=u["a"].applyEffects(g.effects,r.geometry);if(S)for(;O--;){const p=d[O];if(p&&!1!==p.enable)switch(p.type){case"CIMSolidFill":case"CIMSolidStroke":{var C;const s=u["a"].applyEffects(p.effects,S),g=Object(f["b"])(s);if(!g)continue;const[d,O,M]=Object(f["d"])(g,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),v="CIMSolidFill"===p.type,x={type:"sdf",geom:s,asFill:v},j=e.primitiveName,k=null!=(C=Object(m["f"])(e.size))?C:10,w=Object(m["f"])(e.rotation),P=Object(m["f"])(e.offsetX),I=Object(m["f"])(e.offsetY),z=p.path,N=p.primitiveName,L=Object(m["e"])(v?l["b"].getFillColor(p):l["b"].getStrokeColor(p)),X=v?{r:0,g:0,b:0,a:0}:Object(m["e"])(l["b"].getStrokeColor(p)),R=l["b"].getStrokeWidth(p);if(!v&&!R)break;let _=!1,A="";for(const e of i)e.primitiveName!==N&&e.primitiveName!==j||(void 0!==e.value?A+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(_=!0));const Y=JSON.stringify({...e,markerGraphics:null}),F=Object(c["b"])(JSON.stringify(x)+z).toString(),H={type:"marker",templateHash:Object(c["b"])(JSON.stringify(r)+JSON.stringify(p)+Y+A).toString(),materialHash:_?()=>F:F,cim:x,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:h,anchorPoint:{x:O,y:M},isAbsoluteAnchorPoint:!1,size:T(e.primitiveName,n,"Size",o,k),rotation:T(e.primitiveName,n,"Rotation",o,w),offsetX:T(e.primitiveName,n,"OffsetX",o,P),offsetY:T(e.primitiveName,n,"OffsetY",o,I),scaleX:1,frameHeight:b,rotateClockwise:e.rotateClockwise,referenceSize:y,sizeRatio:d,color:T(N,n,"Color",o,L,D),outlineColor:T(N,n,"Color",o,X,D),outlineWidth:T(N,n,"Width",o,R),markerPlacement:e.markerPlacement,path:z};a.push(H);break}default:F(e,t,r,n,i,o,a,s,h,y,b)}}}function Y(e,t,r,i,n,o,a,s,u,h){const y=t.geometry,b=r[0],p=r[1],g=Object(f["b"])(y);if(!g)return;const[d,O,S]=Object(f["d"])(g,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),C={type:"sdf",geom:y,asFill:!0},M=e.primitiveName,v=Object(m["f"])(e.size),x=Object(m["f"])(e.rotation),j=Object(m["f"])(e.offsetX),k=Object(m["f"])(e.offsetY),w=p.path,P=p.primitiveName,I=b.primitiveName,z=Object(m["e"])(l["b"].getFillColor(p)),N=Object(m["e"])(l["b"].getStrokeColor(b)),L=l["b"].getStrokeWidth(b);let X=!1,R="";for(const c of i)c.primitiveName!==P&&c.primitiveName!==I&&c.primitiveName!==M||(void 0!==c.value?R+=`-${c.primitiveName}-${c.propertyName}-${JSON.stringify(c.value)}`:c.valueExpressionInfo&&(X=!0));const _=JSON.stringify({...e,markerGraphics:null}),A=Object(c["b"])(JSON.stringify(C)+w).toString(),Y={type:"marker",templateHash:Object(c["b"])(JSON.stringify(t)+JSON.stringify(p)+JSON.stringify(b)+_+R).toString(),materialHash:X?()=>A:A,cim:C,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:O,y:S},isAbsoluteAnchorPoint:!1,size:T(e.primitiveName,n,"Size",o,v),rotation:T(e.primitiveName,n,"Rotation",o,x),offsetX:T(e.primitiveName,n,"OffsetX",o,j),offsetY:T(e.primitiveName,n,"OffsetY",o,k),scaleX:1,frameHeight:h,rotateClockwise:e.rotateClockwise,referenceSize:u,sizeRatio:d,color:T(P,n,"Color",o,z,D),outlineColor:T(I,n,"Color",o,N,D),outlineWidth:T(I,n,"Width",o,L),markerPlacement:e.markerPlacement,path:w};a.push(Y)}function F(e,t,r,i,n,o,s,f,u,h,y){const b=H(e,r);let p=[];const g=["Rotation","OffsetX","OffsetY"];p=n.filter(t=>t.primitiveName!==e.primitiveName||-1===g.indexOf(t.propertyName));let d="";for(const a of n)void 0!==a.value&&(d+=`-${a.primitiveName}-${a.propertyName}-${JSON.stringify(a.value)}`);const[O,S,C]=l["b"].getTextureAnchor(b,f),M=e.primitiveName,v=Object(m["f"])(e.rotation),x=Object(m["f"])(e.offsetX),j=Object(m["f"])(e.offsetY),k=Object(c["b"])(JSON.stringify(b)+d).toString(),w={type:"marker",templateHash:k,materialHash:0===p.length?k:G(k,i,p,o),cim:b,materialOverrides:p,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:u,anchorPoint:{x:O,y:S},isAbsoluteAnchorPoint:!1,size:e.size,rotation:T(M,i,"Rotation",o,v),offsetX:T(M,i,"OffsetX",o,x),offsetY:T(M,i,"OffsetY",o,j),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:y,rotateClockwise:e.rotateClockwise,referenceSize:h,sizeRatio:C/Object(a["c"])(e.size),markerPlacement:e.markerPlacement};s.push(w)}function H(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath}}function J(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function D(e){if(!e||0===e.length)return null;const t=new i["a"](e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function T(e,t,r,i,n,o,a){const c=t[e];if(c){const e=c[r];if("string"==typeof e||"number"==typeof e||e instanceof Array)return o?o.call(null,e,a):e;if(null!=e&&e instanceof s["a"])return(t,r,c)=>{let s=Object(h["a"])(e,t,{$view:c},i.geometryType,r);return null!==s&&o&&(s=o.call(null,s,a)),null!==s?s:n}}return n}function G(e,t,r,i){for(const n of r)if(n.valueExpressionInfo){const e=t[n.primitiveName]&&t[n.primitiveName][n.propertyName];e instanceof s["a"]&&(n.fn=(t,r,n)=>Object(h["a"])(e,t,{$view:n},i.geometryType,r))}return(t,i,n)=>{for(const e of r)e.fn&&(e.value=e.fn(t,i,n));return Object(c["b"])(e+l["c"].buildOverrideKey(r)).toString()}}function U(e,t){if(!t||0===t.length)return e;const r=JSON.parse(JSON.stringify(e));return l["c"].applyOverrides(r,t),r}function $(e,t){let r=!1,i="";for(const n of e)n.primitiveName===t&&(void 0!==n.value?i+=`-${n.primitiveName}-${n.propertyName}-${JSON.stringify(n.value)}`:n.valueExpressionInfo&&(r=!0));return[r,i]}function W(e,t,r){if(e&&t)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=e.symbolLayers;if(!i)return;for(const e of i)switch(e.type){case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMCharacterMarker":case"CIMPictureMarker":"url"in e&&e.url&&r.push(t.fetchResource(e.url,null));break;case"CIMVectorMarker":{const i=e.markerGraphics;if(!i)continue;for(const e of i)if(e){const i=e.symbol;i&&W(i,t,r)}}}}}}const E=e=>e&&2===e.length&&e[0].enable&&e[1].enable&&"CIMSolidStroke"===e[0].type&&"CIMSolidFill"===e[1].type&&!e[0].effects&&!e[1].effects},"5dbb":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("a9ab"),n=r("b6a7"),o=r("fe24"),a=r("9344");const c=96/72;class s{static executeEffects(e,t){const r=Object(n["c"])(t),i=c;let s=new o["a"](r);for(const n of e){const e=Object(a["a"])(n);e&&(s=e.execute(s,n,i,!0))}return s}static next(e){const t=e.next();return Object(n["d"])(t),t}static applyEffects(e,t){if(!e)return t;let r=new o["a"](t);for(const i of e){const e=Object(a["a"])(i);e&&(r=e.execute(r,i,1,!1))}let n,c=null;for(;n=r.next();)c?Object(i["h"])(c)?Object(i["h"])(n)&&c.paths.push(...n.paths):Object(i["g"])(c)&&Object(i["g"])(n)&&c.rings.push(...n.rings):c=n;return c}}},"7b82":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("793f3"),n=r("0eee"),o=r("405c"),a=r("36b8");const c=512;class s{constructor(e){this._resourceManager=e}dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(e,t,r){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===e.type||"esriSFS"===e.type){const[r,n,o]=i["d"].rasterizeSimpleFill(this._rasterizationCanvas,e.style,t);return{size:[n,o],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===e.type||"esriSLS"===e.type||"line"===e.type&&e.dashTemplate){let t,r;if("simple-line"===e.type||"esriSLS"===e.type)switch(t=Object(i["e"])(e.style,e.cap),e.cap){case"butt":r="Butt";break;case"square":r="Square";break;default:r="Round"}else t=e.dashTemplate,r=e.cim.capStyle;const[n,o,a]=i["d"].rasterizeSimpleLine(t,r);return{size:[o,a],image:new Uint32Array(n.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let a,c,s;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(a=i["b"].fromSimpleMarker(e),s=Object(o["c"])(a)):e.cim&&"CIMHatchFill"===e.cim.type?(a=i["b"].fromCIMHatchFill(e.cim),c=new n["a"](a.frame.xmin,-a.frame.ymax,a.frame.xmax-a.frame.xmin,a.frame.ymax-a.frame.ymin)):e.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.cim.markerPlacement.type?(a=i["b"].fromCIMInsidePolygon(e.cim),c=new n["a"](a.frame.xmin,-a.frame.ymax,a.frame.xmax-a.frame.xmin,a.frame.ymax-a.frame.ymin)):(a=e.cim,s=Object(o["c"])(a)),s&&!r){const[e,t,r]=Object(o["a"])(s);return e?{size:[t,r],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[l,f,m,u,h]=i["b"].rasterize(this._rasterizationCanvas,a,c,this._resourceManager,!r);return l?{size:[f,m],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,anchorX:u,anchorY:h}:null}rasterizeImageResource(e,t,r,i){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=t;const n=this._rasterizationCanvas.getContext("2d");r instanceof ImageData?n.putImageData(r,0,0):(r.setAttribute("width",e+"px"),r.setAttribute("height",t+"px"),n.drawImage(r,0,0,e,t));const o=n.getImageData(0,0,e,t),s=new Uint8Array(o.data);if(i)for(const a of i)if(a&&a.oldColor&&4===a.oldColor.length&&a.newColor&&4===a.newColor.length){const[e,t,r,i]=a.oldColor,[n,o,c,l]=a.newColor;if(e===n&&t===o&&r===c&&i===l)continue;for(let a=0;a<s.length;a+=4)e===s[a]&&t===s[a+1]&&r===s[a+2]&&i===s[a+3]&&(s[a]=n,s[a+1]=o,s[a+2]=c,s[a+3]=l)}let l;for(let a=0;a<s.length;a+=4)l=s[a+3]/255,s[a]=s[a]*l,s[a+1]=s[a+1]*l,s[a+2]=s[a+2]*l;let f=s,m=e,u=t;const h=c;if(m>=h||u>=h){const r=m/u;r>1?(m=h,u=Math.round(h/r)):(u=h,m=Math.round(h*r)),f=new Uint8Array(4*m*u);const i=new Uint8ClampedArray(f.buffer);Object(a["k"])(s,e,t,i,m,u,!1)}return{size:[m,u],image:new Uint32Array(f.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}},"89cb":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("ce50"),n=r("e92d"),o=r("008c");function a(e,t,r,i,o){const a=e.referencesGeometry()&&o?s(t,i,o):t,c=e.repurposeFeature(a);try{return e.evaluate({...r,$feature:c})}catch(l){return n["a"].getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",l),null}}const c=new Map;function s(e,t,r){const{transform:i,hasZ:n,hasM:o}=r;c.has(t)||c.set(t,l(t));const a=c.get(t)(e.geometry,i,n,o);return{...e,geometry:a}}function l(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,i,n)=>Object(o["e"])(r,t,e,i,n);case"esriGeometryPolygon":return(e,r,i,n)=>Object(o["f"])(r,t,e,i,n);case"esriGeometryPolyline":return(e,r,i,n)=>Object(o["g"])(r,t,e,i,n);case"esriGeometryMultipoint":return(e,r,i,n)=>Object(o["d"])(r,t,e,i,n);default:return n["a"].getLogger("esri.views.2d.support.arcadeOnDemand").error(new i["a"]("mapview-arcade","Unable to handle geometryType: "+e)),e=>e}}},d114:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n}));const i=new Float32Array(1);new Uint32Array(i.buffer);function n(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function o(e,t){return 65535&e|t<<16}function a(e,t,r,i){return 255&e|(255&t)<<8|(255&r)<<16|i<<24}},fcb9:function(e,t,r){"use strict";r.r(t),r.d(t,"previewCIMSymbol",(function(){return k}));var i,n=r("a915"),o=r("9ef0"),a=r("2eab"),c=r("f4cc"),s=r("b3b6"),l=r("a9ab"),f=r("4fcb"),m=r("27a2"),u=r("7b82"),h=r("357b"),y=r("36b8"),b=r("d445"),p=r("485a");!function(e){e.Legend="legend",e.Preview="preview"}(i||(i={}));const g=(e,t,r)=>{if(e&&e.targetSize){let i;if(r){const t=Math.max(r.frame.xmax-r.frame.xmin,r.frame.ymax-r.frame.ymin);i=e.targetSize/Object(n["c"])(t)}else i=e.targetSize/t.referenceSize;return i}return e&&e.scaleFactor?e.scaleFactor:1},d={fill:{legend:{frame:{xmax:15,xmin:0,ymax:15,ymin:0},geometry:{rings:[[[0,15],[15,7.5],[15,0],[0,0],[0,15]]]},canvasPaths:{rings:[[[0,15],[0,0],[15,7.5],[15,15],[0,15]]]}},preview:{frame:{xmax:100,xmin:0,ymax:100,ymin:0},geometry:{rings:[[[0,100],[100,100],[100,0],[0,0],[0,100]]]},canvasPaths:{rings:[[[0,100],[0,0],[100,0],[100,100],[0,100]]]}}},stroke:{legend:{frame:{xmax:24,xmin:0,ymax:2,ymin:-2},geometry:{paths:[[[0,0],[12,0],[24,0]]]},canvasPaths:{paths:[[[0,2],[12,2],[24,2]]]}},preview:{frame:{xmax:100,xmin:0,ymax:2,ymin:-2},geometry:{paths:[[[0,0],[50,0],[100,0]]]},canvasPaths:{paths:[[[0,2],[50,2],[100,2]]]}}}};class O{constructor(e,t){this._spatialReference=e,this._avoidSDF=t,this._resourceCache=new Map,this._pictureMarkerCache=new Map,this._textRasterizer=new h["a"],this._cimResourceManager=new m["a"],this._rasterizer=new u["a"](this._cimResourceManager)}async rasterizeCIMSymbolAsync(e,t,r,i,n,o,a,c){i=i||(t?null!=t.centroid?"esriGeometryPolygon":Object(l["c"])(t.geometry):null)||C(e);const s=await this.analyzeCIMSymbol(e,t?S(t.attributes):null,r,i,c);return this.rasterizeCIMSymbol(s,t,i,n,o,a)}async analyzeCIMSymbol(e,t,r,i,n){const o=[],a=t?{geometryType:i,spatialReference:this._spatialReference,fields:t}:null;let s;await Object(f["b"])(e.data,a,this._cimResourceManager,o,this._avoidSDF),Object(c["u"])(n);for(const c of o)"CIMPictureMarker"!==c.cim.type&&"CIMPictureFill"!==c.cim.type&&"CIMPictureStroke"!==c.cim.type||(s||(s=[]),s.push(this.fetchPictureMarkerResource(c,n))),r&&"text"===c.type&&"string"==typeof c.text&&c.text.indexOf("[")>-1&&(c.text=Object(y["c"])(r,c.text,c.cim.textCase));return s&&await Promise.all(s),o}async fetchPictureMarkerResource(e,t){const r=e.materialHash;if(!this._pictureMarkerCache.get(r)){const i=(await Object(a["default"])(e.cim.url,{responseType:"image",signal:t&&t.signal})).data;this._pictureMarkerCache.set(r,i)}}rasterizeCIMSymbol(e,t,r,i,n,o){const a=[];for(const c of e){i&&"function"==typeof i.scaleFactor&&(i.scaleFactor=i.scaleFactor(t,n,o));const e=this._getRasterizedResource(c,t,r,i,n,o);if(!e)continue;let s=0,l=e.anchorX||0,f=e.anchorY||0,m=!1,u=0,h=0;if("esriGeometryPoint"===r){const e=g(i,c,null);if(u=Object(y["d"])(c.offsetX,t,n,o)*e||0,h=Object(y["d"])(c.offsetY,t,n,o)*e||0,"marker"===c.type)s=Object(y["d"])(c.rotation,t,n,o)||0,m=!!c.rotateClockwise&&c.rotateClockwise;else if("text"===c.type){if(s=Object(y["d"])(c.angle,t,n,o)||0,void 0!==c.horizontalAlignment)switch(c.horizontalAlignment){case"left":l=-.5;break;case"right":l=.5;break;default:l=0}if(void 0!==c.verticalAlignment)switch(c.verticalAlignment){case"top":f=.5;break;case"bottom":f=-.5;break;case"baseline":f=-.25;break;default:f=0}}}null!=e&&a.push({angle:s,rotateClockWise:m,anchorX:l,anchorY:f,offsetX:u,offsetY:h,rasterizedResource:e})}return this.getSymbolImage(a)}getSymbolImage(e){const t=document.createElement("canvas"),r=t.getContext("2d");let i=0,o=0,a=0,c=0;const s=[];for(let u=0;u<e.length;u++){const t=e[u],l=t.rasterizedResource;if(!l)continue;const f=l.size,m=t.offsetX,h=t.offsetY,y=t.anchorX,b=t.anchorY,p=t.rotateClockWise||!1;let g=t.angle,d=Object(n["c"])(m)-f[0]*(.5+y),O=Object(n["c"])(h)-f[1]*(.5+b),S=d+f[0],C=O+f[1];if(g){p&&(g=-g);const e=Math.sin(g*Math.PI/180),t=Math.cos(g*Math.PI/180),r=d*t-O*e,i=d*e+O*t,n=d*t-C*e,o=d*e+C*t,a=S*t-C*e,c=S*e+C*t,s=S*t-O*e,l=S*e+O*t;d=Math.min(r,n,a,s),O=Math.min(i,o,c,l),S=Math.max(r,n,a,s),C=Math.max(i,o,c,l)}i=d<i?d:i,o=O<o?O:o,a=S>a?S:a,c=C>c?C:c;const M=r.createImageData(l.size[0],l.size[1]);M.data.set(new Uint8ClampedArray(l.image.buffer));const v={offsetX:m,offsetY:h,rotateClockwise:p,angle:g,rasterizedImage:M,anchorX:y,anchorY:b};s.push(v)}t.width=a-i,t.height=c-o;const l=-i,f=c;for(let u=0;u<s.length;u++){const e=s[u],t=this._imageDataToCanvas(e.rasterizedImage),i=e.rasterizedImage.width,o=e.rasterizedImage.height,a=l-i*(.5+e.anchorX),c=f-o*(.5-e.anchorY);if(e.angle){const i=(360-e.angle)*Math.PI/180;r.save(),r.translate(Object(n["c"])(e.offsetX),-Object(n["c"])(e.offsetY)),r.translate(l,f),r.rotate(i),r.translate(-l,-f),r.drawImage(t,a,c),r.restore()}else r.drawImage(t,a+Object(n["c"])(e.offsetX),c-Object(n["c"])(e.offsetY))}const m=new p["b"]({x:l/t.width-.5,y:f/t.height-.5});return{imageData:0!==t.width&&0!==t.height?r.getImageData(0,0,t.width,t.height):r.createImageData(1,1),anchorPosition:m}}_imageDataToCanvas(e){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const t=this._imageDataCanvas,r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.putImageData(e,0,0),t}_imageTo32Array(e,t,r,i){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const n=this._imageDataCanvas,a=n.getContext("2d");if(n.width=t,n.height=r,a.drawImage(e,0,0,t,r),i){a.save();const n=new o["a"](i);a.fillStyle=n.toHex(),a.globalCompositeOperation="multiply",a.fillRect(0,0,t,r),a.globalCompositeOperation="destination-atop",a.drawImage(e,0,0,t,r),a.restore()}return new Uint32Array(a.getImageData(0,0,t,r).data.buffer)}_getRasterizedResource(e,t,r,n,o,a){let c,l,f,m,u=null,h=null;if("esriGeometryPolyline"===r||"esriGeometryPolygon"===r){const m=n&&n.style?n.style:i.Legend,b="esriGeometryPolyline"===r?d.stroke[m]:d.fill[m];if("line"===e.type){if("CIMSolidStroke"!==e.cim.type){if("CIMPictureStroke"===e.cim.type){const r=Object(y["d"])(e.width,t,o,a),i=Object(y["d"])(e.color,t,o,a),{image:n,width:c,height:s}=this._getPictureResource(e,r,i);return this._rasterizePictureResource(e,n,c,s,b,r)}return null}({analyzedCIM:c,hash:f}=M(e,t,o,a)),l=this._embedCIMLayerInVectorMarker(c,b)}else if("marker"===e.type){if("CIMPictureMarker"===e.cim.type)return null;if("CIMVectorMarker"!==e.cim.type)return null;e.cim.offsetX=Object(y["d"])(e.offsetX,t,o,a),e.cim.offsetY=Object(y["d"])(e.offsetY,t,o,a),e.cim.rotation=Object(y["d"])(e.rotation,t,o,a),e.cim.markerPlacement=e.markerPlacement,({analyzedCIM:c}=M(e,t,o,a)),f=Object(s["b"])(JSON.stringify(c)).toString(),l=this._embedCIMLayerInVectorMarker(c,b),u=Object(y["d"])(e.size,t,o,a),h=e.path}else{if("text"===e.type)return null;if("fill"===e.type){if("CIMHatchFill"===e.cim.type||"CIMVectorMarker"===e.cim.type||"CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type){const r=e.cim.size||e.cim.height;let i,n,s;if("CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type)({image:i,width:n,height:s}=this._getPictureResource(e,r,Object(y["d"])(e.color,t,o,a)));else{({analyzedCIM:c,hash:f}=M(e,t,o,a));const l=this._rasterizer.rasterizeJSONResource({cim:c,type:e.type,url:e.url,mosaicHash:f,size:r,path:h},1,this._avoidSDF);i=l.image,n=l.size[0],s=l.size[1]}return this._rasterizePictureResource(e,i,n,s,b,null)}if("CIMSolidFill"!==e.cim.type)return null;({analyzedCIM:c,hash:f}=M(e,t,o,a)),l=this._embedCIMLayerInVectorMarker(c,b)}}}else{if("text"===e.type)return m=this._rasterizeTextResource(e,t,n,o,a),m;({analyzedCIM:c,hash:f}=M(e,t,o,a));const r=g(n,e,null);if("CIMPictureMarker"===e.cim.type){const i=Object(y["d"])(e.size,t,o,a)*r,{image:n,width:c,height:s}=this._getPictureResource(e,i,Object(y["d"])(e.color,t,o,a));return m={image:n,size:[c,s],sdf:!1,simplePattern:!1,anchorX:e.anchorPoint?e.anchorPoint.x:0,anchorY:e.anchorPoint?e.anchorPoint.y:0},m}Object(b["d"])(c,r,{preserveOutlineWidth:!1}),l=c}f+=r,n&&(f+=JSON.stringify(n));const p=this._resourceCache;return p.has(f)?p.get(f):(m=this._rasterizer.rasterizeJSONResource({cim:l,type:e.type,url:e.url,mosaicHash:f,size:u,path:h},window.devicePixelRatio||1,this._avoidSDF),p.set(f,m),m)}_rasterizeTextResource(e,t,r,i,n){const o=g(r,e,null),a=Object(y["d"])(e.text,t,i,n);if(!a||0===a.length)return null;const c=Object(y["d"])(e.fontName,t,i,n),s=Object(y["d"])(e.style,t,i,n),l=Object(y["d"])(e.weight,t,i,n),f=Object(y["d"])(e.decoration,t,i,n),m=Object(y["d"])(e.size,t,i,n)*o,u=Object(y["d"])(e.horizontalAlignment,t,i,n),h=Object(y["d"])(e.verticalAlignment,t,i,n),b=Object(y["b"])(Object(y["d"])(e.color,t,i,n)),p=Object(y["b"])(Object(y["d"])(e.outlineColor,t,i,n)),d={color:b,size:m,horizontalAlignment:u,verticalAlignment:h,font:{family:c,style:s,weight:l,decoration:f},halo:{size:Object(y["d"])(e.outlineSize,t,i,n)||0,color:p,style:s},pixelRatio:1,premultiplyColors:!this._avoidSDF};return this._textRasterizer.rasterizeText(a,d)}_rasterizePictureResource(e,t,r,i,o,a){const c=document.createElement("canvas"),s=c.getContext("2d");c.height=Object(n["c"])(Math.max(o.frame.ymax-o.frame.ymin,a)),c.width=Object(n["c"])(o.frame.xmax-o.frame.xmin);const f=s.createImageData(r,i);f.data.set(new Uint8ClampedArray(t.buffer));const m=this._imageDataToCanvas(f),u=s.createPattern(m,"repeat"),h=Math.cos((-e.cim.rotation||0)*Math.PI/180),y=Math.sin((-e.cim.rotation||0)*Math.PI/180);u.setTransform({m11:h,m12:y,m21:-y,m22:h,m41:Object(n["c"])(e.cim.offsetX)||0,m42:Object(n["c"])(e.cim.offsetY)||0});const b=o.canvasPaths;let p,g,d;Object(l["g"])(b)?(p=b.rings,s.fillStyle=u,g=s.fill,d=["evenodd"]):Object(l["h"])(b)&&(p=b.paths,s.strokeStyle=u,s.lineWidth=a,g=s.stroke,p[0][0][1]=c.height/2,p[0][1][1]=c.height/2),s.beginPath();for(const l of p){const e=l?l.length:0;if(e>1){let t=l[0];s.moveTo(Object(n["c"])(t[0]),Object(n["c"])(t[1]));for(let r=1;r<e;++r)t=l[r],s.lineTo(Object(n["c"])(t[0]),Object(n["c"])(t[1]));s.closePath()}}g.apply(s,d);const O=s.getImageData(0,0,c.width,c.height),S=new Uint8Array(O.data);return{size:[c.width,c.height],image:new Uint32Array(S.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}_getPictureResource(e,t,r){const i=this._pictureMarkerCache.get(e.materialHash);if(!i)return null;const o=i.height/i.width,a=t?o>1?Object(n["c"])(t):Object(n["c"])(t)/o:i.width,c=t?o>1?Object(n["c"])(t)*o:Object(n["c"])(t):i.height;return{image:this._imageTo32Array(i,a,c,r),width:a,height:c}}_embedCIMLayerInVectorMarker(e,t){const r=Object(l["g"])(t.geometry)?"CIMPolygonSymbol":"CIMLineSymbol",i=t.frame;return{type:"CIMVectorMarker",frame:i,size:i.ymax-i.ymin,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t.geometry,symbol:{type:r,symbolLayers:[e]}}]}}}function S(e){return(e?Object.keys(e):[]).map(t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"}))}function C(e){if(!(e&&e.data&&e.data.symbol))return null;switch(e.data.symbol.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function M(e,t,r,i){let n,o;return"function"==typeof e.materialHash?(n=(0,e.materialHash)(t,r,i),o=Object(f["a"])(e.cim,e.materialOverrides)):(n=e.materialHash,o=e.cim),{analyzedCIM:o,hash:n}}var v=r("4bad");const x=new O(null,!0),j=120;async function k(e,t={}){const{size:r,maxSize:i,node:o,opacity:a}=t,c=t.cimOptions||t,{feature:s,fieldMap:l,geometryType:f,style:m}=c,u=Object(b["c"])(e),h=Math.min(null!=r?r:u,null!=i?i:Object(n["d"])(j));h!==u&&(e=e.clone(),Object(b["e"])(e,h,{preserveOutlineWidth:!0}));let y=3;e&&e.data&&e.data.symbol&&"CIMPointSymbol"!==e.data.symbol.type&&(y=1);const p=await x.rasterizeCIMSymbolAsync(e,s,l,f,{scaleFactor:y,style:m}),g=document.createElement("canvas");g.width=p.imageData.width,g.height=p.imageData.height,g.getContext("2d").putImageData(p.imageData,0,0);let d=g.width/y,O=g.height/y;if(null!=r&&(null==(null==t?void 0:t.scale)||(null==t?void 0:t.scale))){const e=d/O;d=e<=1?Math.ceil(h*e):h,O=e<=1?h:Math.ceil(h/e)}const S=new Image(d,O);S.src=g.toDataURL(),null!=a&&(S.style.opacity=""+a);let C=S;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:d,height:O,src:S.src},fill:null,stroke:null,offset:[0,0]};C=Object(v["a"])([[e]],[d,O],{effectView:t.effectView})}return o&&o.appendChild(C),C}}}]);
//# sourceMappingURL=chunk-310f07ff.80fcfe78.js.map